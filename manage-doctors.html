<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Doctors</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
        }

        .login-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 100%;
        }

        .login-box h2 {
            color: #667eea;
            text-align: center;
            margin-bottom: 30px;
        }

        .dashboard {
            display: none;
        }

        .header {
            background: white;
            padding: 20px 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            color: #667eea;
            font-size: 24px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .content {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .add-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: none;
        }

        .add-form.active {
            display: block;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .doctors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .doctor-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .doctor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .doctor-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: bold;
            margin: 0 auto 15px;
        }

        .doctor-card h3 {
            text-align: center;
            color: #333;
            margin-bottom: 5px;
        }

        .doctor-card .specialty {
            text-align: center;
            color: #667eea;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .doctor-card .info {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }

        .card-actions {
            display: flex;
            gap: 10px;
        }

        .message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .message.success {
            background: #d1fae5;
            color: #065f46;
        }

        .message.error {
            background: #fee2e2;
            color: #991b1b;
        }

        .time-slots-input {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .time-slot-tag {
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
        }

        .time-slot-tag button {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .header {
                padding: 20px;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .doctors-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-container">
        <div class="login-box">
            <h2>üîê Admin Login</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" id="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Login</button>
                <div id="loginError" style="color: #ef4444; text-align: center; margin-top: 10px;"></div>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <div class="header">
            <h1>üë®‚Äç‚öïÔ∏è Manage Doctors</h1>
            <div class="header-actions">
                <a href="admin.html" class="btn btn-secondary">View Bookings</a>
                <button class="btn btn-primary" onclick="toggleAddForm()">+ Add Doctor</button>
                <button class="btn btn-danger" id="logoutBtn">Logout</button>
            </div>
        </div>

        <div class="content">
            <div id="message" class="message"></div>

            <!-- Add/Edit Form -->
            <div id="addForm" class="add-form">
                <h2 id="formTitle" style="margin-bottom: 20px; color: #333;">Add New Doctor</h2>
                <form id="doctorForm">
                    <input type="hidden" id="doctorId" value="">
                    <input type="hidden" id="editMode" value="false">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Doctor Name *</label>
                            <input type="text" id="name" required placeholder="Dr. John Doe">
                        </div>
                        <div class="form-group">
                            <label>Specialty *</label>
                            <input type="text" id="specialty" required placeholder="e.g., Cardiologist">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Education</label>
                            <input type="text" id="education" placeholder="MBBS, MD">
                        </div>
                        <div class="form-group">
                            <label>Experience</label>
                            <input type="text" id="experience" placeholder="e.g., 15 years">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Institution Name</label>
                            <input type="text" id="institutionName" placeholder="e.g., Square Hospital">
                        </div>
                        <div class="form-group">
                            <label>Designation</label>
                            <input type="text" id="designation" placeholder="e.g., Senior Consultant">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Phone</label>
                            <input type="tel" id="phone" placeholder="01XXXXXXXXX">
                        </div>
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="emailDoctor" placeholder="doctor@example.com">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Maximum Patients Per Day</label>
                            <input type="number" id="maxPatients" placeholder="e.g., 30" min="1">
                        </div>
                        <div class="form-group">
                            <label>Facebook Profile Link</label>
                            <input type="url" id="facebookLink" placeholder="https://facebook.com/...">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Chamber Name</label>
                            <input type="text" id="chamberName" placeholder="e.g., Square Hospital">
                        </div>
                        <div class="form-group">
                            <label>Chamber Address</label>
                            <input type="text" id="chamberAddress" placeholder="Full address">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Chamber Time</label>
                            <input type="text" id="chamberTime" placeholder="9:00 AM - 5:00 PM">
                        </div>
                        <div class="form-group">
                            <label>Consultation Fee</label>
                            <input type="text" id="consultationFee" placeholder="1500 BDT">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Available Days (comma separated)</label>
                        <input type="text" id="availableDays" placeholder="Saturday, Sunday, Monday">
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button type="submit" class="btn btn-primary" id="submitBtn">Save Doctor</button>
                        <button type="button" class="btn btn-secondary" onclick="toggleAddForm()">Cancel</button>
                    </div>
                </form>
            </div>

            <!-- Doctors List -->
            <div id="doctorsList" class="doctors-grid"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, getDocs, doc, deleteDoc, updateDoc, getDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyBgL3nTaBFS1789IwrsFb1SN4T7GIas3Jk",
            authDomain: "doctor-booking-b556e.firebaseapp.com",
            projectId: "doctor-booking-b556e",
            storageBucket: "doctor-booking-b556e.firebasestorage.app",
            messagingSenderId: "573037462071",
            appId: "1:573037462071:web:a21ae3786e8b8a3758b5b2",
            measurementId: "G-NQ9BK8LFJM"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Auth state observer
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                loadDoctors();
            } else {
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
            }
        });

        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                await signInWithEmailAndPassword(auth, email, password);
            } catch (error) {
                document.getElementById('loginError').textContent = 'Invalid credentials';
            }
        });

        // Logout
        document.getElementById('logoutBtn').addEventListener('click', () => signOut(auth));

        // Toggle add form
// Toggle add form
window.toggleAddForm = function() {
    const form = document.getElementById('addForm');
    form.classList.toggle('active');
    if (!form.classList.contains('active')) {
        document.getElementById('doctorForm').reset();
        document.getElementById('doctorId').value = '';
        document.getElementById('editMode').value = 'false';
        document.getElementById('formTitle').textContent = 'Add New Doctor';
        document.getElementById('submitBtn').textContent = 'Save Doctor';
    }
};

// NEW: Edit doctor function
window.editDoctor = async function(doctorId) {
    try {
        // Import getDoc if not already imported at top
        const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
        
        const docRef = doc(db, 'doctors', doctorId);
        const docSnap = await getDoc(docRef);
        
        if (!docSnap.exists()) {
            showMessage('Doctor not found!', 'error');
            return;
        }
        
        const doctor = docSnap.data();
        
        // Fill form with doctor data
        document.getElementById('doctorId').value = doctorId;
        document.getElementById('editMode').value = 'true';
        document.getElementById('name').value = doctor.name || '';
        document.getElementById('specialty').value = doctor.specialty || '';
        document.getElementById('education').value = doctor.education || '';
        document.getElementById('experience').value = doctor.experience || '';
        document.getElementById('institutionName').value = doctor.institutionName || '';
        document.getElementById('designation').value = doctor.designation || '';
        document.getElementById('phone').value = doctor.phone || '';
        document.getElementById('emailDoctor').value = doctor.email || '';
        document.getElementById('maxPatients').value = doctor.maxPatients || '';
        document.getElementById('facebookLink').value = doctor.facebookLink || '';
        document.getElementById('chamberName').value = doctor.chamberName || '';
        document.getElementById('chamberAddress').value = doctor.chamberAddress || '';
        document.getElementById('chamberTime').value = doctor.chamberTime || '';
        document.getElementById('consultationFee').value = doctor.consultationFee || '';
        document.getElementById('availableDays').value = doctor.availableDays ? doctor.availableDays.join(', ') : '';
        
        // Change form title and button
        document.getElementById('formTitle').textContent = 'Edit Doctor';
        document.getElementById('submitBtn').textContent = 'Update Doctor';
        
        // Show form
        document.getElementById('addForm').classList.add('active');
        
        // Scroll to form
        document.getElementById('addForm').scrollIntoView({ behavior: 'smooth' });
        
    } catch (error) {
        console.error('Error loading doctor:', error);
        showMessage('Failed to load doctor data', 'error');
    }
};

// Add or Update doctor
document.getElementById('doctorForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const availableDaysInput = document.getElementById('availableDays').value;
    const editMode = document.getElementById('editMode').value === 'true';
    const doctorId = document.getElementById('doctorId').value;

    const doctorData = {
        name: document.getElementById('name').value,
        specialty: document.getElementById('specialty').value,
        education: document.getElementById('education').value,
        experience: document.getElementById('experience').value,
        institutionName: document.getElementById('institutionName').value,
        designation: document.getElementById('designation').value,
        phone: document.getElementById('phone').value,
        email: document.getElementById('emailDoctor').value,
        maxPatients: document.getElementById('maxPatients').value,
        facebookLink: document.getElementById('facebookLink').value,
        chamberName: document.getElementById('chamberName').value,
        chamberAddress: document.getElementById('chamberAddress').value,
        chamberTime: document.getElementById('chamberTime').value,
        consultationFee: document.getElementById('consultationFee').value,
        availableDays: availableDaysInput ? availableDaysInput.split(',').map(d => d.trim()) : [],
        status: 'Active'
    };

    try {
        if (editMode && doctorId) {
            // UPDATE existing doctor
            const { doc, updateDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
            await updateDoc(doc(db, 'doctors', doctorId), doctorData);
            showMessage('Doctor updated successfully!', 'success');
        } else {
            // ADD new doctor
            doctorData.createdAt = serverTimestamp();
            await addDoc(collection(db, 'doctors'), doctorData);
            showMessage('Doctor added successfully!', 'success');
        }
        
        document.getElementById('doctorForm').reset();
        document.getElementById('doctorId').value = '';
        document.getElementById('editMode').value = 'false';
        document.getElementById('formTitle').textContent = 'Add New Doctor';
        document.getElementById('submitBtn').textContent = 'Save Doctor';
        toggleAddForm();
        loadDoctors();
        
    } catch (error) {
        console.error('Error saving doctor:', error);
        showMessage(editMode ? 'Failed to update doctor.' : 'Failed to add doctor.', 'error');
    }
});
        // Load doctors
        async function loadDoctors() {
            try {
                const querySnapshot = await getDocs(collection(db, 'doctors'));
                const doctors = [];
                querySnapshot.forEach((doc) => {
                    doctors.push({ id: doc.id, ...doc.data() });
                });

                displayDoctors(doctors);
            } catch (error) {
                console.error('Error loading doctors:', error);
            }
        }

        // Display doctors
        function displayDoctors(doctors) {
            const container = document.getElementById('doctorsList');

            if (doctors.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">No doctors added yet.</p>';
                return;
            }

            container.innerHTML = doctors.map(doctor => `
                <div class="doctor-card">
                    <div class="doctor-avatar">${doctor.name.charAt(0)}</div>
                    <h3>${doctor.name}</h3>
                    <div class="specialty">${doctor.specialty || 'Specialist'}</div>
<div class="info">
    <strong>Institution:</strong> ${doctor.institutionName || 'Not specified'}<br>
    <strong>Designation:</strong> ${doctor.designation || 'Not specified'}<br>
    <strong>Chamber:</strong> ${doctor.chamberName || 'Not specified'}<br>
    <strong>Max Patients:</strong> ${doctor.maxPatients || 'Not specified'}/day<br>
    <strong>Fee:</strong> ${doctor.consultationFee || 'Contact for details'}
</div>
<div class="card-actions">
    <button class="btn btn-primary" style="flex: 1;" onclick="editDoctor('${doctor.id}')">Edit</button>
    <button class="btn btn-danger" style="flex: 1;" onclick="deleteDoctor('${doctor.id}')">Delete</button>
</div>
                </div>
            `).join('');
        }

        // Delete doctor
        window.deleteDoctor = async function(doctorId) {
            if (!confirm('Are you sure you want to delete this doctor?')) return;

            try {
                await deleteDoc(doc(db, 'doctors', doctorId));
                showMessage('Doctor deleted successfully!', 'success');
                loadDoctors();
            } catch (error) {
                showMessage('Failed to delete doctor.', 'error');
            }
        };

        // Show message
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = text;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
